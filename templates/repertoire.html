<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Visionneuse Locale</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <nav class="navbar">
      <a href="/">Accueil</a>
      <a href="/map">√Ä propos de moi</a>
      <a href="/repertoire">R√©pertoire d'images</a>
    </nav>

    <div class="content">
      <h1>Visionneuse de Photos Locale</h1>
      <p>
        Choisissez un dossier sur votre ordinateur pour visualiser ses images
        sans les importer.
      </p>

      <div style="margin: 30px 0">
        <input
          type="file"
          id="dossierInput"
          webkitdirectory
          directory
          multiple
          style="display: none"
        />
        <button
          onclick="document.getElementById('dossierInput').click()"
          style="
            padding: 15px 25px;
            font-size: 16px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
          "
        >
          üìÅ S√©lectionner un dossier d'images
        </button>
      </div>

      <div id="preview-container" style="display: none; margin-bottom: 40px">
        <img
          id="main-view"
          src=""
          style="
            max-width: 90%;
            max-height: 600px;
            border: 8px solid white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
          "
        />
        <h3 id="image-name" style="margin-top: 15px"></h3>
      </div>

      <hr
        style="
          width: 80%;
          margin: 40px auto;
          border: 0;
          border-top: 1px solid #ccc;
        "
      />

      <div class="galerie" id="galerie-locale"></div>
    </div>

    <script>
      const input = document.getElementById("dossierInput");
      const galerie = document.getElementById("galerie-locale");
      const previewContainer = document.getElementById("preview-container");
      const mainView = document.getElementById("main-view");
      const imageName = document.getElementById("image-name");

      input.addEventListener("change", function (e) {
        galerie.innerHTML = ""; // On vide la galerie si on change de dossier
        const fichiers = e.target.files;

        for (let i = 0; i < fichiers.length; i++) {
          const f = fichiers[i];

          // On v√©rifie que c'est bien une image
          if (f.type.startsWith("image/")) {
            const reader = new FileReader();

            reader.onload = function (event) {
              // Cr√©ation de la miniature
              const div = document.createElement("div");
              div.className = "carte-image";
              div.style.cursor = "pointer";

              const img = document.createElement("img");
              img.src = event.target.result;

              // Quand on clique sur la miniature, elle s'affiche en grand
              div.onclick = function () {
                mainView.src = event.target.result;
                imageName.innerText = f.name;
                previewContainer.style.display = "block";
                window.scrollTo({ top: 0, behavior: "smooth" });
              };

              div.appendChild(img);

              const label = document.createElement("div");
              label.className = "nom-fichier";
              label.innerText = f.name;
              div.appendChild(label);

              galerie.appendChild(div);
            };

            reader.readAsDataURL(f);
          }
        }
      });
    </script>
  </body>
</html>
